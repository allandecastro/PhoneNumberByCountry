#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const yargs_1 = require("yargs");
const fs = require("fs");
const path = require("path");
const constants = require("../constants");
const taskRunner_1 = require("../taskRunner");
const taskGroup_1 = require("../taskGroup");
try {
    if (!yargs_1.argv._ || yargs_1.argv._.length === 0 || !Object.keys(taskGroup_1.standardTaskGroups).includes(yargs_1.argv._[0])) {
        printUsage();
    }
    const fileConfig = fs.readFileSync(path.resolve('.', constants.CONFIGURATION_FILE_NAME));
    const config = JSON.parse(fileConfig.toString());
    const taskRunner = new taskRunner_1.TaskRunner(yargs_1.argv, config);
    taskRunner.run(taskGroup_1.standardTaskGroups).catch((e) => {
        onError(e);
    });
}
catch (e) {
    onError(e);
}
function onError(e) {
    console.error(`[pcf-scripts] [Error] encountered unexpected error:\n${e}`);
    process.exit(1);
}
function printUsage() {
    console.log('Unsupported command');
    console.log(`Usage: pcf-scripts ${Object.keys(taskGroup_1.standardTaskGroups).map(verb => '[' + verb + ']').join(' ')}`);
    process.exit(0);
}
